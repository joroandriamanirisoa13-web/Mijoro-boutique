<!DOCTYPE html>
<html lang="mg">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mijoro Boutique — Shop Secure</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
  <!-- ==================== TOPBAR ==================== -->
  <header class="topbar">
    <h1>Mijoro Boutique</h1>
    <div style="display:flex; gap:8px;">
      <button id="loginBtn" class="btn">🔒 Login</button>
      <button id="addBtn" class="btn primary" hidden>➕ Ajouter</button>
    </div>
  </header>

  <!-- ==================== FILTERS ==================== -->
  <section class="filters">
    <input type="search" id="searchInput" placeholder="🔍 Karohy produit..." class="search">
  </section>

  <!-- ==================== PRODUCT GRID ==================== -->
  <main class="grid" id="productList">
    <p class="empty">Miandry ny entana...</p>
  </main>

  <!-- ==================== ADD PRODUCT MODAL ==================== -->
  <dialog id="addModal" class="modal">
    <div class="modal-header">
      <h3>Produit vaovao</h3>
      <button class="icon-btn" onclick="closeModal()">✖</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <label>
          Anaran’ny Produit
          <input type="text" id="pTitle" placeholder="ex: Sneakers, Phone...">
        </label>
        <label>
          Vidiny (Ar)
          <input type="number" id="pPrice" placeholder="10000">
        </label>
        <label class="full">
          Famaritana
          <textarea id="pDesc" rows="3" placeholder="famaritana fohy..."></textarea>
        </label>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal()">❌ Annuler</button>
      <button class="btn primary" id="saveBtn">💾 Enregistrer</button>
    </div>
  </dialog>

  <script src="app-secure.js"></script>
  <script>
    // ========== UI LOGIC ==========
    const modal = document.getElementById('addModal');
    const addBtn = document.getElementById('addBtn');
    const saveBtn = document.getElementById('saveBtn');

    function closeModal() { modal.close(); }

    addBtn.addEventListener('click', () => {
      document.getElementById('pTitle').value = '';
      document.getElementById('pPrice').value = '';
      document.getElementById('pDesc').value = '';
      modal.showModal();
    });

    saveBtn.addEventListener('click', async () => {
      await saveProduct();
      modal.close();
    });

    // ========== SEARCH ==========
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', e => {
      const q = e.target.value.toLowerCase();
      const list = document.querySelectorAll('.card');
      list.forEach(card => {
        const title = card.querySelector('h3')?.textContent.toLowerCase() || '';
        card.style.display = title.includes(q) ? 'flex' : 'none';
      });
    });
  </script>
</body>
</html>